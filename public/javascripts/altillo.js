
var wh = [
  {
    name: "never alta n2",
    values: [
      { date: "1", value: "78" },
      { date: "2", value: "49" },
      { date: "3", value: "46" },
      { date: "4", value: "46" },
      { date: "5", value: "45" },
      { date: "6", value: "44" },
      { date: "7", value: "44" },
      { date: "8", value: "44" },
      { date: "9", value: "48" },
      { date: "10", value: "50" },
      { date: "11", value: "50" },
      { date: "12", value: "52" },
      { date: "13", value: "52" },
      { date: "14", value: "47" },
      { date: "15", value: "45" },
      { date: "16", value: "42" },
      { date: "17", value: "54" },
      { date: "18", value: "64" },
      { date: "19", value: "43" },
      { date: "20", value: "42" },
      { date: "21", value: "41" },
      { date: "22", value: "60" },
      { date: "23", value: "59" },
      { date: "24", value: "42" }
    ]
  },
  {
    name: "nevera alta n1",
    values: [
      { date: "1", value: "98" },
      { date: "2", value: "96" },
      { date: "3", value: "97" },
      { date: "4", value: "97" },
      { date: "5", value: "96" },
      { date: "6", value: "95" },
      { date: "7", value: "95" },
      { date: "8", value: "51" },
      { date: "9", value: "0" },
      { date: "10", value: "65" },
      { date: "11", value: "97" },
      { date: "12", value: "102" },
      { date: "13", value: "102" },
      { date: "14", value: "124" },
      { date: "15", value: "94" },
      { date: "16", value: "114" },
      { date: "17", value: "98" },
      { date: "18", value: "105" },
      { date: "19", value: "118" },
      { date: "20", value: "90" },
      { date: "21", value: "110" },
      { date: "22", value: "112"},
      { date: "23", value: "89" },
      { date: "24", value: "102" }
    ]
  },
  {
    name: "arcon n4",
    values: [
      { date: "1", value: "0" },
      { date: "2", value: "0" },
      { date: "3", value: "0" },
      { date: "4", value: "0" },
      { date: "5", value: "0" },
      { date: "6", value: "0" },
      { date: "7", value: "0" },
      { date: "8", value: "17" },
      { date: "9", value: "29" },
      { date: "10", value: "28" },
      { date: "11", value: "28" },
      { date: "12", value: "28" },
      { date: "13", value: "28" },
      { date: "14", value: "28" },
      { date: "15", value: "28" },
      { date: "16", value: "29" },
      { date: "17", value: "27" },
      { date: "18", value: "28" },
      { date: "19", value: "28" },
      { date: "20", value: "28" },
      { date: "21", value: "29" },
      { date: "22", value: "27"},
      { date: "23", value: "12" },
      { date: "24", value: "0" }
    ]
  },
  {
    name: "arcon n2 final pasillo",
    values: [
      { date: "1", value: "12" },
      { date: "2", value: "107" },
      { date: "3", value: "108" },
      { date: "4", value: "106" },
      { date: "5", value: "115" },
      { date: "6", value: "167" },
      { date: "7", value: "112" },
      { date: "8", value: "92" },
      { date: "9", value: "163" },
      { date: "10", value: "128" },
      { date: "11", value: "110" },
      { date: "12", value: "141" },
      { date: "13", value: "135" },
      { date: "14", value: "169" },
      { date: "15", value: "134" },
      { date: "16", value: "174" },
      { date: "17", value: "171" },
      { date: "18", value: "167" },
      { date: "19", value: "119" },
      { date: "20", value: "155" },
      { date: "21", value: "119" },
      { date: "22", value: "147"},
      { date: "23", value: "118" },
      { date: "24", value: "107" }
    ]
  },
  {
    name: "arcon n1 final pasillo",
    values: [
      { date: "1", value: "80" },
      { date: "2", value: "91" },
      { date: "3", value: "99" },
      { date: "4", value: "97" },
      { date: "5", value: "85" },
      { date: "6", value: "83" },
      { date: "7", value: "129" },
      { date: "8", value: "128" },
      { date: "9", value: "125" },
      { date: "10", value: "98" },
      { date: "11", value: "115" },
      { date: "12", value: "127" },
      { date: "13", value: "126" },
      { date: "14", value: "85" },
      { date: "15", value: "134" },
      { date: "16", value: "134" },
      { date: "17", value: "130" },
      { date: "18", value: "128" },
      { date: "19", value: "127" },
      { date: "20", value: "126" },
      { date: "21", value: "85" },
      { date: "22", value: "96"},
      { date: "23", value: "114" },
      { date: "24", value: "83" }
    ]
  },
  {
    name: "arcon n3 pasillo",
    values: [
      { date: "1", value: "124" },
      { date: "2", value: "124" },
      { date: "3", value: "125" },
      { date: "4", value: "124" },
      { date: "5", value: "125" },
      { date: "6", value: "124"},
      { date: "7", value: "124" },
      { date: "8", value: "125" },
      { date: "9", value: "124" },
      { date: "10", value: "125"},
      { date: "11", value: "132" },
      { date: "12", value: "126" },
      { date: "13", value: "125" },
      { date: "14", value: "166"},
      { date: "15", value: "127" },
      { date: "16", value: "163" },
      { date: "17", value: "128" },
      { date: "18", value: "128" },
      { date: "19", value: "169" },
      { date: "20", value: "124" },
      { date: "21", value: "160"},
      { date: "22", value: "134"},
      { date: "23", value: "126" },
      { date: "24", value: "125" }
    ]
  }
];




var signal=[
  {
    name: "nevera_alta_1",
    values: [
      { date: "1", value: "0" },
      { date: "2", value: "0" },
      { date: "3", value: "0" },
      { date: "4", value: "0" },
      { date: "5", value: "0" },
      { date: "6", value: "0"},
      { date: "7", value: "0" },
      { date: "8", value: "0" },
      { date: "9", value: "0" },
      { date: "10", value: "1"},
      { date: "11", value: "3" },
      { date: "12", value: "2" },
      { date: "13", value: "4" },
      { date: "14", value: "8"},
      { date: "15", value: "8" },
      { date: "16", value: "5" },
      { date: "17", value: "1" },
      { date: "18", value: "0" },
      { date: "19", value: "2" },
      { date: "20", value: "0" },
      { date: "21", value: "0"},
      { date: "22", value: "0"},
      { date: "23", value: "0" },
      { date: "24", value: "0" }
    ]
  },
  {
    name: "nevera alta n1/ arcon n2 final pasillo",
    values: [
      { date: "1", value: "0" },
      { date: "2", value: "0" },
      { date: "3", value: "0" },
      { date: "4", value: "0" },
      { date: "5", value: "0" },
      { date: "6", value: "0"},
      { date: "7", value: "0" },
      { date: "8", value: "0" },
      { date: "9", value: "0" },
      { date: "10", value: "0"},
      { date: "11", value: "0" },
      { date: "12", value: "1" },
      { date: "13", value: "1" },
      { date: "14", value: "2"},
      { date: "15", value: "2" },
      { date: "16", value: "3" },
      { date: "17", value: "3" },
      { date: "18", value: "3" },
      { date: "19", value: "3" },
      { date: "20", value: "1" },
      { date: "21", value: "2"},
      { date: "22", value: "2"},
      { date: "23", value: "3" },
      { date: "24", value: "0" }
    ]
  }
];


var width = 1000;
var height = 450;
var margin = 90;
var mar2 = 80;
var duration = 250;

var lineOpacity = "0.25";
var lineOpacityHover = "0.85";
var otherLinesOpacityHover = "0.1";
var lineStroke = "4px";
var lineStrokeHover = "4.5px";

var circleOpacity = '0.85';
var circleOpacityOnLineHover = "0.25"
var circleRadius = 3;
var circleRadiusHover = 6;
var axistransform1=width-margin;
var axistransform2=axistransform1+40;


var parseDate1 = d3.timeParse("%d")

var parseDate = d3.timeParse("%H");



wh.forEach(function(d) {
  d.values.forEach(function(d) {
    d.date = parseDate(d.date);
  });
});
signal.forEach(function(d) {
  d.values.forEach(function(d) {
    d.date = parseDate(d.date);
    d.value = +d.value;
  });
});


/* Scale */
var xScale = d3.scaleTime()
  .domain(d3.extent(wh[0].values, d => d.date))
  .range([0, width-margin]);
var yScale = d3.scaleLinear()
  .domain([0, 225])
  .range([height-margin, 0]);
var nyScale =  d3.scaleLinear()
  .domain([0, d3.max(signal[0].values, d => d.value)])
  .range([height-margin, 0]);


/* ALTILLO SVG */
var svg = d3.select("#chart").append("svg")
  .attr("width", (width+margin)+"px")
  .attr("height", (height+margin)+"px")
  .append('g')
  .attr("transform", `translate(${mar2},20)`);


  /*
---------------------------
          EJES
---------------------------
*/

/*ALTILLO*/
var line = d3.line()
  .x(d => xScale(d.date))
  .y(d => yScale(d.value))
var line2 =d3.line()
  .x(d=>xScale(d.date))
  .y(d=> nyScale(d.value))



let lines = svg.append('g')
  .attr('class', 'lines');


var color = d3.scaleOrdinal(d3.schemeCategory10);

/*
GROUP2
*/
/*ALTILLO*/
lines.selectAll('.line-group2')
    .data(signal).enter()
    .append('g')
    .attr('class', 'line-group2')
    .on("mouseover", function(d, i) {
        svg.append("text")
          .attr("class", "title-text")
          .style("fill", color(i))
          .text(d.name)
          .attr("text-anchor", "middle")
          .attr("x", (width-margin)/2)
          .attr("y", -15);
      })
      .on("mouseout", function(d) {
        svg.select(".title-text").remove();
      })
    .append('path')
    .attr("width","px")
    .attr('class', 'line')
    .attr('d', d => line2(d.values))
    .style('stroke', (d, i) => color(i))
    .style('opacity', lineOpacity)
    .style('fill',(d, i) => color(i));

	/*
-----------------------------------------------------------------------------------------------
                  GROUP1 SELECT
-------------------------------------------------------------------------------------------------
*/

	    /*ALTILLO*/
lines.selectAll('.line-group')
  .data(wh).enter()
  .append('g')
  .attr('class', 'line-group')
  .on("mouseover", function(d, i) {
      svg.append("text")
        .attr("class", "title-text")
        .style("fill", color(i))
        .text(d.name)
        .attr("text-anchor", "middle")
        .attr("x", (width-margin)/2)
        .attr("y", -15);
  })
  .on("mouseout", function(d) {
      svg.select(".title-text").remove();
  })
  .append('path')
  .attr('class', 'line')
  .attr('d', d => line(d.values))
  .style('stroke', (d, i) => color(i))
  .style('opacity', lineOpacity)
  .style("stroke-width", lineStroke)
  .on("mouseover", function(d) {
      d3.selectAll('.line')
					.style('opacity', otherLinesOpacityHover);
      d3.selectAll('.circle')
					.style('opacity', circleOpacityOnLineHover);
      d3.select(this)
        .style('opacity', lineOpacityHover)
        .style("stroke-width", lineStrokeHover)
        .style("cursor", "pointer");
    })
  .on("mouseout", function(d) {
      d3.selectAll(".line")
					.style('opacity', lineOpacity);
      d3.selectAll('.circle')
					.style('opacity', circleOpacity);
      d3.select(this)
        .style("stroke-width", lineStroke)
        .style("cursor", "none");
  });



/*
-------------------------------------------------------------------------------------------------------
              CIRCLES
-----------------------------------------------------------------------------------------------------------
*/
/*ALTILLO*/
lines.selectAll("circle-group")
  .data(wh).enter()
  .append("g")
  .style("fill", (d, i) => color(i))
  .selectAll("circle")
  .data(d => d.values).enter()
  .append("g")
  .attr("class", "circle")
  .on("mouseover", function(d) {
      d3.select(this)
        .style("cursor", "pointer")
        .append("text")
        .attr("class", "text")
        .text(`${d.value}`)
        .attr("x", d => xScale(d.date) + 5)
        .attr("y", d => yScale(d.value) - 10);
    })
  .on("mouseout", function(d) {
      d3.select(this)
        .style("cursor", "none")
        .transition()
        .duration(duration)
        .selectAll(".text").remove();
    })
  .append("circle")
  .attr("cx", d => xScale(d.date))
  .attr("cy", d => yScale(d.value))
  .attr("r", circleRadius)
  .style('opacity', circleOpacity)
  .on("mouseover", function(d) {
        d3.select(this)
          .transition()
          .duration(duration)
          .attr("r", circleRadiusHover);
      })
    .on("mouseout", function(d) {
        d3.select(this)
          .transition()
          .duration(duration)
          .attr("r", circleRadius);
      });

var xAxis = d3.axisBottom(xScale).ticks(24);
var yAxis = d3.axisLeft(yScale).ticks(25);
var nyAxis =d3.axisRight(nyScale).ticks(8);



svg.append("g")
    .attr("class", "x axis")
    .attr("transform", `translate(0, ${height-margin})`)
    .call(xAxis);
svg.append("g")
    .attr("class", "y axis")
    .call(yAxis)
    .append('text')
    .attr("y", 15)
    .attr("x",20)
    .attr("fill", "#000")
    .text("Wh")
    .attr("transform","translate(-15,-20)")
svg.append("g")
    .attr("class", "y axis")
    .attr("transform","translate("+axistransform1+",0)")
    .call(nyAxis)
    .append('text')
    .attr("y", 15)
    .attr("fill", "#000")
    .text("Mediciones")
    .attr("transform","translate(-15,-25)");


          /*
----------------------------------------
        Mouseover animation
----------------------------------------
*/
var divToolTip = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 1e-6);

function mouseover() {
	divToolTip.transition()
		.duration(700)
        .style("opacity", 1);
    }
function mouseout() {
     divToolTip.transition()
        .duration(500)
        .style("opacity", 1e-6);
}





var z = d3.scaleOrdinal()
	.range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);




	/*
--------------------------------------------------------------------------------
                            LEGEND
--------------------------------------------------------------------------------
*/
/*ALTILLO*/
var legend1 = svg.append("g")
      .attr("font-family", "sans-serif")
      .attr("font-size", 10)
      .attr("text-anchor", "end")
      .selectAll("g")
      .data(wh)
        .enter().append("g")
        .attr("transform", function(d, i) { return "translate(60," + i * 26 + ")"; });


 legend1.append("rect")
      .attr("x", width - 20)
      .attr("width", 20)
      .attr("height", 20)
      .attr("fill",(d, i) => color(i) );

  legend1.append("text")
      .attr("x", width - 25)
      .attr("y", 10)
      .attr("dy", "0.4em")
      .text(function(d) { return d.name; });
